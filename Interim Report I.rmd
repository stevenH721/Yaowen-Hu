The URL for our Team GitHub repository is https://github.com/stevenH721/Yaowen-Hu.git
The URL to the Kernel and Kaggle dataset is https://www.kaggle.com/jboysen/ny-home-mortgage
title: "Interim Report I"
output: word_document
---
1. What is the data problem? What is the final managerial objective?
# To begin with, some of the column names are not clear enough. For example, the "applicant_date_indicator" is confusing. 
# Secondly, there are too much missing data, leaving a lot of blank space in the data, which seems abundant.
#Thirdly, the data set is seriously biased. The sample contains 283335 white applicants, but only 27890 asian applicants, indicating that the sample is not randomly selected.   

# managerial objective: The bank would like to provide loans to the applicants that are in a good financial status, thus are least likely to default.

2. Describe the measurement types of each variable
 

3. Create a table summarizing the range or variation in each variable. Add statistics (mean,
median, standard deviation, etc.) as you deem necessary.
```{r}

```

4. How do you handle missing data in this dataset?
# Firstly, we need to decide whether the missing data is missing at random. For instance, applicants with lower income may not be willing to reveal their income level. 
## If the data is missing at random, we could simply remove the missing data sample since we have huge amount of observations. There are 2 types of deletion: listwise, 
# Listwise deletion (complete-case analysis) removes all data for an observation if there is one or more missing values. For example, in this dataset, most spaces in colomn V43 in blank, so we could delete this column for simplicity. Pairwise deletion analyses all cases in which the variables of interest are present and thus maximizes all data available by an analysis basis.
# If the data is missing not at random, we could replace missing data with substituted values. For instance, one of the choices is to replace the missing data with the mean of the data we have. Using this method, we could avoid circumstances such as default listwise deletion. 

5. Provide histograms/density plots for key variables, such as action taken on loan, gender, ethnicity, etc.
```{r}
# Histogram for action taken on loan
homeMortgageStatus = homeMortgage %>% group_by(action_taken_name) %>%
summarise(CountOfActionTaken = n()) %>%
arrange(desc(CountOfActionTaken))

ggplot(homeMortgageStatus, aes(x = reorder(action_taken_name, CountOfActionTaken), y = CountOfActionTaken)) +
geom_bar(stat='identity',colour="white", fill ="yellow") +
geom_text(aes(x = action_taken_name, y=1,sep="",label=paste0(CountOfActionTaken)),
            hjust=0, vjust=.5, size = 4, colour = 'black',
            fontface = 'bold') +
labs(x = 'action_taken_name', y = 'Count Of Action Taken', title = 'Actions in Loans') +
coord_flip() + 
theme_bw()
```

```{r}
# Histogram for gender
homeMortgageGender = homeMortgage %>% group_by(applicant_sex_name) %>%
summarise(CountOfSex = n()) %>%
arrange(desc(CountOfSex))

ggplot(homeMortgageGender, aes(x = reorder(applicant_sex_name, CountOfSex), y = CountOfSex)) +
geom_bar(stat='identity',colour="white", fill ="yellow") +
geom_text(aes(x = applicant_sex_name, y=1,sep="",label=paste0(CountOfSex)),
            hjust=0, vjust=.5, size = 4, colour = 'black',
            fontface = 'bold') +
labs(x = 'Gender', y = 'Count', title = 'Histogram for Gender') +
coord_flip() + 
theme_bw()
```

```{r}
# Histogram for ethnicity
homeMortgageEthnicity = homeMortgage %>% group_by(applicant_ethnicity_name) %>%
summarise(CountOfEthnicity = n()) %>%
arrange(desc(CountOfEthnicity))

ggplot(homeMortgageEthnicity, aes(x = reorder(applicant_ethnicity_name, CountOfEthnicity), y = CountOfEthnicity)) +
geom_bar(stat='identity',colour="white", fill ="yellow") +
geom_text(aes(x = applicant_ethnicity_name, y=1,sep="",label=paste0(CountOfEthnicity)),
            hjust=0, vjust=.5, size = 4, colour = 'black',
            fontface = 'bold') +
labs(x = 'Ethinicity', y = 'Count', title = 'Histogram for Ethnicity') +
coord_flip() + 
theme_bw()
```

```{r}
# Histogram for applicant's income
hist(homeMortgage$applicant_income_000s,main="Histogram of income",n=100,xlab="Applicant's income in thousands",ylab="Count",col="yellow",xlim=c(0,1500))
```

6. Create bivariate frequency distributions (tables or plots) for key variables
```{r}
# Bivariate frequency distribution for ethnicity
homeMortgageEthnicity2 = homeMortgage %>% group_by(action_taken_name,applicant_ethnicity_name) %>%
summarise(CountOfActionTaken = n()) 
homeMortgageEthnicity = homeMortgage %>% group_by(applicant_ethnicity_name) %>%
summarise(CountOfEthnicity = n()) 

homeMortgageEthnicity3 = inner_join(homeMortgageEthnicity,homeMortgageEthnicity2) %>%
mutate(percentage = (CountOfActionTaken/CountOfEthnicity) * 100 ) 

homeMortgageEthnicity3 %>%
  ggplot(aes(x = reorder(action_taken_name, percentage), 
                               y = percentage)) +
  geom_bar(stat='identity',colour="white", fill ="yellow") +
  facet_wrap(~ applicant_ethnicity_name) +
  geom_text(aes(x = action_taken_name, y = 1, label = paste0("(",round(percentage),"%)",sep="")),
            hjust=0, vjust=.5, size = 4, colour = 'black',
            fontface = 'bold') +
  labs(x = 'action_taken_name', y = '%age Count Of Action Taken', title = 'Actions in Loans') +
  coord_flip() + 
  theme_bw()

```

```{r}
# Bivariate frequency distribution for gender
homeMortgageGender2 = homeMortgage %>% group_by(action_taken_name,applicant_sex_name) %>%
summarise(CountOfActionTaken = n()) 
homeMortgageGender = homeMortgage %>% group_by(applicant_sex_name) %>%
summarise(CountOfSex = n()) 

homeMortgageGender3 = inner_join(homeMortgageGender,homeMortgageGender2) %>%
mutate(percentage = (CountOfActionTaken/CountOfSex) * 100 ) 

homeMortgageGender3 %>%
  ggplot(aes(x = reorder(action_taken_name, percentage), 
                               y = percentage)) +
  geom_bar(stat='identity',colour="white", fill ="yellow") +
  facet_wrap(~ applicant_sex_name) +
  geom_text(aes(x = action_taken_name, y = 1, label = paste0("(",round(percentage),"%)",sep="")),
            hjust=0, vjust=.5, size = 4, colour = 'black',
            fontface = 'bold') +
  labs(x = 'action_taken_name', y = '%age Count Of Action Taken', title = 'Actions in Loans') +
  coord_flip() + 
  theme_bw()
```

```{r}
# Bivariate frequency distribution for applicant's income
breaks = seq(0,400,50)

homeMortgage %>%
  
ggplot(aes(applicant_income_000s)) +
  scale_x_continuous(limits = c(0, 400),breaks=breaks ) +
  geom_histogram(binwidth = 10,,fill = c("yellow")) +
  labs(x = 'Income in Thousands', y = 'Count', title = 'Loan Originated Applicant Income distribution') +  theme_bw()+facet_wrap(~action_taken_name)
```

7. Discuss what the data patterns indicate, and what this could mean for the probability of
getting a loan approved.
```{r}
selectedCols = c("action_taken","applicant_ethnicity",        
"applicant_income_000s","applicant_race_1","co_applicant_ethnicity",
"co_applicant_sex", "county_code","hoepa_status","lien_status",
"loan_purpose","loan_type","msamd",                                              
"owner_occupancy","preapproval",
"property_type","purchaser_type","loan_amount_000s")

homeMortgage_selectedCols = homeMortgage %>% select(selectedCols) %>%
  mutate(isLoanOriginated = FALSE)  %>%
  mutate(isLoanOriginated = replace(isLoanOriginated, action_taken == 1, TRUE)) %>%
  select(-action_taken)

homeMortgage_selectedCols$applicant_ethnicity = as.factor(homeMortgage_selectedCols$applicant_ethnicity)
homeMortgage_selectedCols$applicant_race_1 = as.factor(homeMortgage_selectedCols$applicant_ethnicity)
homeMortgage_selectedCols$co_applicant_ethnicity = as.factor(homeMortgage_selectedCols$co_applicant_ethnicity)
homeMortgage_selectedCols$co_applicant_sex = as.factor(homeMortgage_selectedCols$co_applicant_sex)
homeMortgage_selectedCols$county_code = as.factor(homeMortgage_selectedCols$county_code)
homeMortgage_selectedCols$hoepa_status =  as.factor(homeMortgage_selectedCols$hoepa_status)
homeMortgage_selectedCols$lien_status =  as.factor(homeMortgage_selectedCols$lien_status)
homeMortgage_selectedCols$loan_purpose =  as.factor(homeMortgage_selectedCols$loan_purpose)
homeMortgage_selectedCols$loan_type =  as.factor(homeMortgage_selectedCols$loan_type)
homeMortgage_selectedCols$owner_occupancy =  as.factor(homeMortgage_selectedCols$owner_occupancy)  
homeMortgage_selectedCols$preapproval =  as.factor(homeMortgage_selectedCols$preapproval)  
homeMortgage_selectedCols$property_type =  as.factor(homeMortgage_selectedCols$property_type) 
homeMortgage_selectedCols$purchaser_type =  as.factor(homeMortgage_selectedCols$purchaser_type)

set.seed(3000)
split = sample.split(homeMortgage_selectedCols$isLoanOriginated, SplitRatio = 0.7)
Train = subset(homeMortgage_selectedCols, split==TRUE)
Test = subset(homeMortgage_selectedCols, split==FALSE)
   
# CART model
homeMortgageTree = rpart(isLoanOriginated ~ ., method="class", data = Train, control=rpart.control(minbucket=5))

prp(homeMortgageTree)
# We randomly selected 3000 samples and set the training set/ test set ratio to be 0.7. According to the result, for instance, loan could be approved if lien_stats is not 4 and purchase is not zaro, loan_pur=3, loan_typ =2,3,4, county_c= 1,5,7,...119 and loan_amo < 418, which is the most complex case. It can also be approved when lien_stats is not 4 and purchase is zero. Therefore, lien_sts is the most important term and purchse is the secondly one. Loan_pur ,loan_typ, county_c and loan_amo are listed in order of importance.




